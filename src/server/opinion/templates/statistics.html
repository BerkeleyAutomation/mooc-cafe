{% extends "admin_base.html" %}{% block scripts %}<script type="text/javascript+protovis">	// Get Stats Data		imgurl_head = "{{assets_url}}statistics/";		var statsInfo;	var allInfo;	var dirs;	var plotdata;	var buttonInfo;	var plotwidth = 600,		plotheight = 400;		required_data = ['button_stats']	retrieve_admin_content(function(data)	{		if(data.success)		{			buttonInfo = data.data.button_stats;		}	}, discussion_id, false);		var timeperiod = 'alltime';		function get_plot_data(){		$.ajax({			url: "{{url_root}}/adminpanel/getdata/" + timeperiod + "/", 			dataType: "json",			async:false,			success: function(data) {				plotdata = data.data;			}		});	}		get_plot_data();				var currentStats=""	/*	function fillStats(key){		$("#numberTable").children().remove();		if(key){			var currentStats=key;			var temp = [];			$.each(statsInfo[key], function(key,val){				temp.push([key, Math.round(100*val)/100]);			});			temp.sort();			$.each(temp, function(index, elem){				$("#numberTable").append("<tr><td>"+elem[0]+"</td><td>"+elem[1]+"</td></tr>");			});		}	}*/    	function toggleView(div, obj, tableKey){		if ($(obj).is(":visible"))			return;				$(obj).toggle();		$(div).children("img:visible").not(obj).toggle();		//fillStats(tableKey);	}	function setupUI(){						$("#rateLength").hide();		$("#fastRatingsButton").click(function(){toggleView("#badUsersBody", "#fastRatings", '');});		$("#rateLengthButton").click(function(){toggleView("#badUsersBody", "#rateLength", '');});				$("#comments_returnedButton").click(function(){show_comments_returned();});		$("#comment_histogramsButton").click(function(){show_view_ratings_per_comment();});		$("#session_gapButton").click(function(){show_session_gap();});		$("#session_durationButton").click(function(){show_session_duration();});		$("#session_countButton").click(function(){show_sessions_per_user();});		$("#sessions_per_dayButton").click(function(){show_user_data();});		$("#agreementButton").click(function(){show_agreement_count();});		$("#insightButton").click(function(){show_insight_count();});		$("#agreement_insight_distrButton").click(						function(){show_agreement_insight_distr();});	}	function show_comments_returned(){				data = plotdata['comments_returned'];		xdata = data[0];		ydata = data[1];				xd = pv.Scale.linear(0, pv.max(xdata)).range(0,w);		yd = pv.Scale.linear(0, pv.max(ydata)).range(0,h);		pointdata = []		for(var i=0; i<xdata.length; i++){			pointdata.push([xdata[i], ydata[i]]);		}		ystats = []		for(var i=0; i< pointdata.length; i++)			ystats.push(pointdata[i][1]);		pointplot.render();				pointdata = pointdata.filter(function(e) {return (e[1] < 1500);});		xd = pv.Scale.linear(0, pv.max(pointdata, function(e) e[0])).range(0,w),		yd = pv.Scale.linear(0, pv.max(pointdata, function(e) e[1])).range(0,h),		ystats = [];		for(var i=0; i < pointdata.length; i++){			ystats.push(parseInt(pointdata[i][1]));		}				$("#plot_histograms").hide();		$("#plot_lines").hide();		$("#plot_points").show();	}		function show_user_data(){		var d = new Date(plotdata['start_date'])		xdata = plotdata['stats_per_day'][0];		y1data = plotdata['stats_per_day'][1];		xd = pv.Scale.linear(0, pv.max(xdata)).range(0,w);		yd = pv.Scale.linear(0, pv.max(y1data)).range(0,h);		title = "# of Sessions per Day";		ylabel = "# of Sessions";		xlabel = "Date";		pointdata = []		for(var i=0; i<xdata.length; i++){			pointdata.push([xdata[i], y1data[i]]);		}		lineplot1.render();				data = plotdata['stats_per_day'];		xdata = data[0];		y2data = data[2]		xd = pv.Scale.linear(0, pv.max(xdata)).range(0,w);		yd = pv.Scale.linear(0, pv.max(y2data)).range(0,h);		title = "# of Ratings per Day";		ylabel = "# of Ratings";		xlabel = "Date";		pointdata2 = []		for(var i=0; i<xdata.length; i++){			pointdata2.push([xdata[i], y2data[i]]);		}		pointdata2.sort(function(e1, e2) {return e1[0]-e2[0];});		lineplot2.render();				xdata = data[0];		y3data = data[3];		xd = pv.Scale.linear(0, pv.max(xdata)).range(0,w);		yd = pv.Scale.linear(0, pv.max(y3data)).range(0,h);		title = "Unique Users per Day";		ylabel = "# of Unique Users";		xlabel = "Date";		pointdata3 = []		for(var i=0; i<xdata.length; i++){			pointdata3.push([xdata[i], y3data[i]]);		}		pointdata3.sort(function(e1,e2) {return e1[0]-e2[0];});		lineplot3.render();				$("#plot_histograms").hide();		$("#plot_lines").show();		$("#plot_points").hide();	}	function show_agreement_insight_distr(){		$("#plot_histograms").show();		$("#plot_lines").hide();		$("#plot_points").hide();				data = plotdata['agreement_ratings'].sort(function(e1, e2) {return e1-e2;});				x.domain(0, pv.max(data));		bins = pv.histogram(data).frequency(false).bins(x.ticks(60));		y.domain(0, pv.max(bins, function(d) d.y)*1.3);		title = "Agreement Rating Distribution";		xlabel = "Agreement Rating";		ylabel = "Normalized Frequency";				data2 = plotdata['insight_rating'].sort(function(e1, e2) {return e1-e2;});		x2.domain(0, pv.max(data2));		bins2 = pv.histogram(data2).frequency(false).bins(x2.ticks(60));		y2.domain(0, pv.max(bins2, function(d) d.y)*1.3);		title2 = "Insightfulness Rating Distribution";		xlabel2 = "Insightfulness Rating";		ylabel2 = "Normalized Frequency";				halfplot1.render();		halfplot2.render();	}	function show_agreement_count(){				$("#plot_histograms").show();		$("#plot_lines").hide();		$("#plot_points").hide();				data = plotdata['agreement_ratings_count'].sort(function(e1, e2) {return e1-e2;});;				x.domain(0, pv.max(data));		bins = pv.histogram(data).bins(x.ticks(60));		y.domain(0, pv.max(bins, function(d) d.y));		title = "# of Agreement Ratings per User Histogram";		xlabel = "# of Ratings";		ylabel = "Count";				data2 = data.filter(function(e) {return (e > 3 && e < 150);})					.sort(function(e1, e2) {return e1-e2;});		x2.domain(0, pv.max(data2));		bins2 = pv.histogram(data2).bins(x2.ticks(60));		y2.domain(0, pv.max(bins2, function(d) d.y));		title2 = "# of Agreement Ratings per User Histogram (Normal Users) ";		xlabel2 = "# of Ratings (3 < ratings < 150)";		ylabel2 = "Count";				halfplot1.render();		halfplot2.render();	}	function show_insight_count(){				$("#plot_histograms").show();		$("#plot_lines").hide();		$("#plot_points").hide();				data = plotdata['insight_ratings_count'].sort(function(e1, e2) {return e1-e2;});				x.domain(0, pv.max(data));		bins = pv.histogram(data).bins(x.ticks(60));		y.domain(0, pv.max(bins, function(d) d.y));		title = "# of Insight Ratings per User Histogram";		xlabel = "# of Ratings";		ylabel = "Count";				data2 = data.filter(function(e) {return (e > 3 && e < 150);})					.sort(function(e1, e2) {return e1-e2;});		x2.domain(0, pv.max(data2));		bins2 = pv.histogram(data2).bins(x2.ticks(60));		y2.domain(0, pv.max(bins2, function(d) d.y));		title2 = "# of Insight Ratings per User Histogram (Normal Users) ";		xlabel2 = "# of Ratings (3 < ratings < 150)";		ylabel2 = "Count";				halfplot1.render();		halfplot2.render();	}	function show_sessions_per_user(){				$("#plot_histograms").show();		$("#plot_lines").hide();		$("#plot_points").hide();				data = plotdata['sessions_per_user'].sort(function(e1, e2) {return e1-e2;});				x.domain(0, pv.max(data));		bins = pv.histogram(data).bins(x.ticks(20));		y.domain(0, pv.max(bins, function(d) d.y));		title = "# of Sessions per User Histogram";		xlabel = "# of Sessions";		ylabel = "Count";				data2 = data.filter(function(e) {return (e < 20);})					.sort(function(e1, e2) {return e1-e2;});		x2.domain(0, pv.max(data2));		bins2 = pv.histogram(data2).bins(x2.ticks(20));		y2.domain(0, pv.max(bins2, function(d) d.y));		title2 = "# of Sessions per User Histogram (Zoomed)";		xlabel2 = "# of Sessions (0 < sessions < 20)";		ylabel2 = "Count";				halfplot1.render();		halfplot2.render();	}		function show_session_duration(){				$("#plot_histograms").show();		$("#plot_lines").hide();		$("#plot_points").hide();				data = plotdata['session_duration'].sort(function(e1, e2) {return e1-e2;});;				x.domain(0, pv.max(data));		bins = pv.histogram(data).bins(x.ticks(20));		y.domain(0, pv.max(bins, function(d) d.y));		title = "Session Duration Histogram";		xlabel = "Session Duration (0 < minutes < 300)";		ylabel = "Count";				data2 = data.filter(function(e) {return (e < 60);})					.sort(function(e1, e2) {return e1-e2;});		x2.domain(0, pv.max(data2));		bins2 = pv.histogram(data2).bins(x2.ticks(30));		y2.domain(0, pv.max(bins2, function(d) d.y));		title2 = "Session Duration Histogram (Zoomed)";		xlabel2 = "Session Duration (0 < minutes < 60)";		ylabel2 = "Count";				halfplot1.render();		halfplot2.render();	}		function show_session_gap(){				$("#plot_histograms").show();		$("#plot_lines").hide();		$("#plot_points").hide();				data = plotdata['session_gap'].sort(function(e1, e2) {return e1-e2;});				x.domain(0, pv.max(data));		bins = pv.histogram(data).bins(x.ticks(20));		y.domain(0, pv.max(bins, function(d) d.y));		title = "Session Gap Histogram";		xlabel = "Average Gap between Sessions for a User (0 < days < 25)";		ylabel = "Count";				data2 = data.filter(function(e) {return (e < 7);})					.sort(function(e1, e2) {return e1-e2;});		x2.domain(0, pv.max(data2));		bins2 = pv.histogram(data2).bins(x2.ticks(30));		y2.domain(0, pv.max(bins2, function(d) d.y));		title2 = "Session Gap Histogram (Frequent Users)";		xlabel2 = "Average Gap between Sessions for a User (0 < days < 7)";		ylabel2 = "Count";				halfplot1.render();		halfplot2.render();	}		function show_view_ratings_per_comment(){				$("#plot_histograms").show();		$("#plot_lines").hide();		$("#plot_points").hide();				data = plotdata['ratings_per_comment'].sort(function(e1, e2) {return e1-e2;});				x.domain(0, pv.max(data));		bins = pv.histogram(data).bins(x.ticks(60));		y.domain(0, pv.max(bins, function(d) d.y));		title = "# of Ratings per Comment Histogram",		ylabel = "Count",		xlabel = "# of Ratings"				data2 = plotdata['views_per_comment'].sort(function(e1, e2) {return e1-e2;});		x2.domain(0, pv.max(data2));		bins2 = pv.histogram(data2).bins(x2.ticks(60));		y2.domain(0, pv.max(bins2, function(d) d.y));		title2 = "# of Views per Comment Histogram",		ylabel2 = "Count",		xlabel2 = "# of Views"				halfplot1.render();		halfplot2.render();	}    $(document).ready(function(){				$("#statsTitle").css({"background-color": "#28405a",								"line-height": "3em",								"padding-left": "5px",								"color": "white"});		$("#badUsers").css({"background-color": "#28405a",								"line-height": "3em",								"padding-left": "5px",								"color": "white"});				$("#UITitle").css({"background-color": "#28405a",							"line-height": "3em",							"padding-left": "5px",							"color": "white"});				$('#statsTitle').hover(function() {			$(this).css('cursor','pointer');		}, function() {			$(this).css('cursor','auto');		});		$('#badUsers').hover(function() {			$(this).css('cursor','pointer');		}, function() {			$(this).css('cursor','auto');		});				$('#UITitle').hover(function() {			$(this).css('cursor','pointer');		}, function() {			$(this).css('cursor','auto');		});		$("#statsTitle").click(function(){				$("#statsBody").toggle();				$("#updated").html(plotdata["last_updated"]);		});				$("#badUsers").click(function(){				$("#badUsersBody").toggle();		});				$("#UITitle").click(function(){				$("#UIBody").toggle();		});				//$("#statsPicContainer").children("img").not("#sessions_per_day").hide();		//fillStats('sessionsPerDay')				$("#UITable").append("<th>Button Name</th><th>Button Press %</th>");				$.each(buttonInfo, function(i, v){			$("#UITable").append("<tr><td>" + v[0] + "</td><td>" + Math.round(v[1]) + "</td></tr>");		});				//$("#date_container").append("Default plots were last updated on: " + allInfo['date_created']);				$("#statsBody").hide();		$("#badUsersBody").hide();		$("#UIBody").hide();				$("#plot_lines").hide();		$("#plot_points").hide();						$("#timeselector").change(function(){			timeperiod = $(this).val();            get_plot_data();			show_user_data();		})				setupUI();				$("#spinner").css({"width":"100px",			"height": "100px",			"position": "relative",			"left": "40%",			"background":"url({{url_root}}/media/images/spinner.gif) no-repeat center"}).hide();	});    </script>{% endblock %}{% block mainContent %}	<h1>Participation Statistics</h1><table id="users" class="overviewTable" style="padding-top:4px;">        	<thead>            	<tr>                <th>Rating Chart</th>                </tr>            </thead>            <tbody id="overviewbody">                <tr><td id="totalActiveUsers">	This chart illustrates the graph of user ratings (only users in the top 50 reviewers).							<script type="text/javascript+protovis">	var miserables = eval({{arc_graph|safe}})	var vis = new pv.Panel()    .width(600)    .height(310)    .bottom(90);var arc = vis.add(pv.Layout.Arc)    .nodes(miserables.nodes)    .links(miserables.links);arc.link.add(pv.Line);arc.node.add(pv.Dot)    .size(function(d) d.linkDegree + 4)    .fillStyle(pv.Colors.category19().by(function(d) d.group))    .strokeStyle(function() this.fillStyle().darker());arc.label.add(pv.Label)vis.render();    </script>	</td></tr>	            </tbody>			<tbody id="overviewcontent">			</tbody>        </table>						<table id="users" class="overviewTable" style="padding-top:4px;">        	<thead>            	<tr>                <th>Return Visits</th>                </tr>            </thead>            <tbody id="overviewbody">                <tr><td id="totalActiveUsers">	This histogram shows the distribution of return vists (x-axis) and the number of users that had that number of return visits (y-axis).				<script type="text/javascript+protovis">	var data = eval({{visits}});	var w = 600,    h = 400,    x = pv.Scale.linear(0, 10).range(0, w),    bins = pv.histogram(data).bins(x.ticks(60)),    y = pv.Scale.linear(0, pv.max(bins, function(d) d.y)).range(0, h);var vis = new pv.Panel()    .width(w)    .height(h)    .margin(30);vis.add(pv.Bar)    .data(bins)    .bottom(0)    .left(function(d) x(d.x))    .width(function(d) x(d.dx))    .height(function(d) y(d.y))    .fillStyle("#aaa")    .strokeStyle("rgba(255, 255, 255, .2)")    .lineWidth(1)    .antialias(false);vis.add(pv.Rule)    .data(y.ticks(5))    .bottom(y)    .strokeStyle("#fff")  .anchor("left").add(pv.Label)    .text(y.tickFormat);vis.add(pv.Rule)    .data(x.ticks())    .left(x)    .bottom(-5)    .height(5)  .anchor("bottom").add(pv.Label)    .text(x.tickFormat);vis.add(pv.Rule)    .bottom(0);vis.render();    </script>	</td></tr>	            </tbody>			<tbody id="overviewcontent">			</tbody>        </table>			<table id="users" class="overviewTable" style="padding-top:4px;">        	<thead>            	<tr>                <th>Comment Size</th>                </tr>            </thead>            <tbody id="overviewbody">                <tr><td id="totalActiveUsers">	The histogram shows the distribution of comment word-length (x-axis).				<script type="text/javascript+protovis">	var data = eval({{word_count}});	var w = 600,    h = 300,    x = pv.Scale.linear(0, {{max_comment}}).range(0, w),    bins = pv.histogram(data).bins(x.ticks(60)),    y = pv.Scale.linear(0, pv.max(bins, function(d) d.y)).range(0, h);var vis = new pv.Panel()    .width(w)    .height(h)    .margin(30);vis.add(pv.Bar)    .data(bins)    .bottom(0)    .left(function(d) x(d.x))    .width(function(d) x(d.dx))    .height(function(d) y(d.y))    .fillStyle("#aaa")    .strokeStyle("rgba(255, 255, 255, .2)")    .lineWidth(1)    .antialias(false);vis.add(pv.Rule)    .data(y.ticks(5))    .bottom(y)    .strokeStyle("#fff")  .anchor("left").add(pv.Label)    .text(y.tickFormat);vis.add(pv.Rule)    .data(x.ticks())    .left(x)    .bottom(-5)    .height(5)  .anchor("bottom").add(pv.Label)    .text(x.tickFormat);vis.add(pv.Rule)    .bottom(0);vis.render();    </script>	</td></tr>	            </tbody>			<tbody id="overviewcontent">			</tbody>        </table>				<table id="users" class="overviewTable" style="padding-top:4px;">        	<thead>            	<tr>                <th>Comments Read</th>                </tr>            </thead>            <tbody id="overviewbody">                <tr><td id="totalActiveUsers">				This histogram shows the distribution of the number of comments read (x-axis).				<script type="text/javascript+protovis">	var data = eval({{comment_read}});	var w = 600,    h = 300,    x = pv.Scale.linear(0, {{max_comment_read}}).range(0, w),    bins = pv.histogram(data).bins(x.ticks(60)),    y = pv.Scale.linear(0, pv.max(bins, function(d) d.y)).range(0, h);var vis = new pv.Panel()    .width(w)    .height(h)    .margin(50);vis.add(pv.Bar)    .data(bins)    .bottom(0)    .left(function(d) x(d.x))    .width(function(d) x(d.dx))    .height(function(d) y(d.y))    .fillStyle("#aaa")    .strokeStyle("rgba(255, 255, 255, .2)")    .lineWidth(1)    .antialias(false);vis.add(pv.Rule)    .data(y.ticks(5))    .bottom(y)    .strokeStyle("#fff")  .anchor("left").add(pv.Label)    .text(y.tickFormat);vis.add(pv.Rule)    .data(x.ticks())    .left(x)    .bottom(-5)    .height(5)  .anchor("bottom").add(pv.Label)    .text(x.tickFormat);vis.add(pv.Rule)    .bottom(0);vis.render();    </script>	</td></tr>	            </tbody>			<tbody id="overviewcontent">			</tbody>        </table><!--	<div id="badUsers" style="width:auto">		<h2>Flagged Users</h2>	</div>	<div id="badUsersBody">				<div id="buttons" style="margin: auto">		    <button id="fastRatingsButton" class="positive">		      Fast Ratings		    </button>		    <button id="rateLengthButton" class="positive">		      Comment Length		    </button>		</div>				<img id="rateLength" src="{{assets_url}}statistics/ratingtime_commentlength.png" height="480px" />     	<img id="fastRatings" src="{{assets_url}}statistics/fastratings.png" height="480px" />	</div>		<div id="UITitle" style="position:static; width:auto">		<h2>UI Statistics</h2>	</div>		<div id="UIBody">		Below is a table of the button name and its contribution in % to the total number of button presses <br/><br/>		<table id="UITable"></table>	</div>	    <div id="statsTitle" style="width:auto">		<h2>Visitor Statistics</h2>	</div>	<div id="statsBody">	<div id="date_container"></div><br/>	<span style='width:50%;display:inline-table'><form action="" method="POST">	Time Period: 		<select id="timeselector" style="margin-right:20px">		<option value="alltime">All Time</option>		<option value="1month">1 Month</option>		<option value="3months">3 Months</option>	</select>	</form></span>	<span>Last Updated: <span id='updated'></span></span> 	<div id="error" style="color: red;"></div>	<div id="buttons" style="margin: auto; padding: 15px">	    <button id="session_countButton" class="positive">	      Session Count	    </button>	    <button id="session_durationButton" class="positive">	      Session Durations	    </button>	    <button id="session_gapButton" class="positive">	      Session Gaps	    </button>	    <button id="comments_returnedButton" class="positive">	      Comments Returned	    </button>	    <button id="comment_histogramsButton" class="positive">	      Comments Histogram	    </button>	    <button id="agreementButton" class="positive">			Agreement Ratings per User	    </button>	    <button id="insightButton" class="positive">		  	Insightfulness Ratings per User	    </button>	    <button id="agreement_insight_distrButton" class="positive">		  	Agreement/Insightfulness Ratings Distr	    </button>		<button id="sessions_per_dayButton" class="positive">	      Users/Day	    </button>	</div>		<div id="spinner"></div>-->	<div id="statsPicContainer" style="float:left; width:520px">		<div id = "plot_histograms">			<script type="text/javascript+protovis"> // first half plot 							//extract correct data				data = plotdata['ratings_per_comment'];				data.sort(function(a,b){return a - b;});						// initialize some variables				var w = plotwidth,					h = plotheight/2,					x = pv.Scale.linear(0, pv.max(data)).range(0,w),					bins = pv.histogram(data).bins(x.ticks(60)),					y = pv.Scale.linear(0, pv.max(bins, function(d) d.y)).range(0,h),					title = "# of Ratings per Comment Histogram",					ylabel = "Count",					xlabel = "# of Ratings"				// create panel				var halfplot1 = new pv.Panel()					.width(w)					.height(h)					.margin(40);										// create x,y rules				halfplot1.add(pv.Rule)				    .data(function() y.ticks(10))				    .bottom(y)				    .strokeStyle("rgba(0, 47, 47, 0.2)")				  .anchor("left").add(pv.Label)				    .text(y.tickFormat);				halfplot1.add(pv.Rule)				    .data(function() x.ticks())				    .left(x)				    .bottom(-5)				    .height(5)				  .anchor("bottom").add(pv.Label)				    .text(x.tickFormat);				halfplot1.add(pv.Rule)				    .bottom(0);							// title				halfplot1.add(pv.Label)					.left(300)					.top(-10)				    .textAlign("center")					.font("bold 14px sans-serif")				    .text(function() title);							// y axis label				halfplot1.add(pv.Label)					.bottom(100)					.left(-25)					.textAngle(-Math.PI/2)				    .textAlign("center")					.font("12px sans-serif")				    .text(function() ylabel);							// x axis label				halfplot1.add(pv.Label)					.bottom(-30)					.left(300)					.textAlign("center")					.font("12px sans-serif")					.text(function() xlabel)							// labels for mean, std, mean				halfplot1.add(pv.Label)					.top(15)					.right(0)					.textAlign("center")					.font("12px sans-serif")					.text(function() "mean: " + Math.round(100*pv.mean(data))/100); // mean						halfplot1.add(pv.Label)					.top(30)					.right(0)					.font("12px sans-serif")					.textAlign("center")					.text(function() "std: " + Math.round(100*pv.deviation(data))/100); //std							halfplot1.add(pv.Label)					.top(45)					.right(0)					.textAlign("center")					.font("12px sans-serif")					.text(function() {						var l = data.length						var median;						if(data.length == 1)							median = data[0];						else if (plotdata.length % 2 == 0)							median = (data[l/2] + data[l/2-1])/2;						else							median = data[Math.floor(l/2)];						median = Math.round(100*median)/100;						return "median: " + median;					}); //median						// plot histogram!				halfplot1.add(pv.Bar)					.data(function() {return bins;}) 					.bottom(0)				    .left(function(d) x(d.x))				    .width(function(d) x(d.dx))				    .height(function(d) y(d.y))				    .fillStyle("#046380")				    .lineWidth(2);								halfplot1.render();					</script>			<script type="text/javascript+protovis"> // second half plot							//extract correct data				data2 = plotdata['views_per_comment'];				data2.sort(function(a,b){return a - b;});						// initialize some variables				var w = plotwidth,					h = plotheight/2,					x2 = pv.Scale.linear(0, pv.max(data2)).range(0,w),					bins2 = pv.histogram(data2).bins(x2.ticks(60)),					y2 = pv.Scale.linear(0, pv.max(bins2, function(d) d.y)).range(0,h),					title2 = "# of Views per Comment Histogram",					ylabel2 = "Count",					xlabel2 = "# of Views"				// create panel				var halfplot2 = new pv.Panel()					.width(w)					.height(h)					.margin(40);										// create x,y rules				halfplot2.add(pv.Rule)				    .data(function() y2.ticks(10))				    .bottom(y2)				    .strokeStyle("rgba(0, 47, 47, 0.2)")				  .anchor("left").add(pv.Label)				    .text(y2.tickFormat);				halfplot2.add(pv.Rule)				    .data(function() x2.ticks())				    .left(x2)				    .bottom(-5)				    .height(5)				  .anchor("bottom").add(pv.Label)				    .text(x2.tickFormat);				halfplot2.add(pv.Rule)				    .bottom(0);							// title				halfplot2.add(pv.Label)					.left(300)					.top(-10)				    .textAlign("center")					.font("bold 14px sans-serif")				    .text(function() title2);							// y axis label				halfplot2.add(pv.Label)					.bottom(100)					.left(-25)					.textAngle(-Math.PI/2)				    .textAlign("center")					.font("12px sans-serif")				    .text(function() ylabel2);							// x axis label				halfplot2.add(pv.Label)					.bottom(-30)					.left(300)					.textAlign("center")					.font("12px sans-serif")					.text(function() xlabel2)							// labels for mean, std, mean				halfplot2.add(pv.Label)					.top(15)					.right(0)					.textAlign("center")					.font("12px sans-serif")					.text(function() "mean: " + Math.round(100*pv.mean(data2))/100); // mean						halfplot2.add(pv.Label)					.top(30)					.right(0)					.font("12px sans-serif")					.textAlign("center")					.text(function() "std: " + Math.round(100*pv.deviation(data2))/100); //std							halfplot2.add(pv.Label)					.top(45)					.right(0)					.textAlign("center")					.font("12px sans-serif")					.text(function() {						var l = data2.length						var median;						if(data2.length == 1)							median = data2[0];						else if (data2.length % 2 == 0)							median = (data2[l/2] + data2[l/2-1])/2;						else							median = data2[Math.floor(l/2)];						median = Math.round(100*median)/100;						return "median: " + median;					}); //median						// plot histogram!				halfplot2.add(pv.Bar)					.data(function() {return bins2;}) 					.bottom(0)				    .left(function(d) x2(d.x))				    .width(function(d) x2(d.dx))				    .height(function(d) y2(d.y))				    .fillStyle("#046380")				    .lineWidth(1);								halfplot2.render();			</script>		</div>		<div id = "plot_lines">			<script type="text/javascript+protovis"> 								xdata = plotdata['stats_per_day'][0];				y1data = plotdata['stats_per_day'][1];						// initialize some variables				var w = plotwidth,					h = plotheight/2,					xd = pv.Scale.linear(0, pv.max(xdata)).range(0,w),					yd = pv.Scale.linear(0, pv.max(y1data)).range(0,h),					title = "# of Sessions per Day",					ylabel = "# of Sessions",					xlabel = "Date";								var lineplot1 = new pv.Panel()				    .width(w)				    .height(h)					.margin(40);								// create x,y rules				lineplot1.add(pv.Rule)				    .data(function() yd.ticks(10))				    .bottom(yd)				    .strokeStyle("rgba(0, 47, 47, 0.2)")				  .anchor("left").add(pv.Label)				    .text(yd.tickFormat);								lineplot1.add(pv.Rule)				    .data(function() xd.ticks(8))				    .left(function(d) xd(d))				    .bottom(-5)				    .height(5)				  .anchor("bottom").add(pv.Label)				  	.text(function(d){						var sd = new Date(plotdata['start_date'].substring(0,10));						sd.setDate(sd.getDate()+d);						return sd.getUTCFullYear()+"-"+(sd.getUTCMonth()+1)+"-"+sd.getUTCDate()					})				    //.text(xd.tickFormat);								lineplot1.add(pv.Rule)				    .bottom(0);				pointdata = []				for(var i=0; i<xdata.length; i++){					pointdata.push([xdata[i], y1data[i]]);				}				lineplot1.add(pv.Line)					.data(function() {return pointdata;})					.bottom(function(d) d[1]*yd(1))					.left(function(d) d[0]*xd(1));								// title				lineplot1.add(pv.Label)					.left(300)					.top(-10)				    .textAlign("center")					.font("bold 14px sans-serif")				    .text(function() title);				// y axis label				lineplot1.add(pv.Label)					.bottom(100)					.left(-25)					.textAngle(-Math.PI/2)				    .textAlign("center")					.font("12px sans-serif")				    .text(function() ylabel);				// x axis label				lineplot1.add(pv.Label)					.bottom(-30)					.left(300)					.textAlign("center")					.font("12px sans-serif")					.text(function() xlabel);								// labels for mean, std, mean				lineplot1.add(pv.Label)					.top(15)					.right(0)					.textAlign("center")					.font("12px sans-serif")					.text(function() "mean: " + Math.round(100*pv.mean(y1data))/100); // mean				lineplot1.add(pv.Label)					.top(30)					.right(0)					.font("12px sans-serif")					.textAlign("center")					.text(function() "std: " + Math.round(100*pv.deviation(y1data))/100); //std				lineplot1.add(pv.Label)					.top(45)					.right(0)					.textAlign("center")					.font("12px sans-serif")					.text(function() {						ystats = [];						for(var i=0; i < y1data.length; i++){							ystats.push(y1data[i]);						}						ystats.sort();						var l = ystats.length;						var median;						if(ystats.length == 1)							median = ystats[0];						else if (ystats.length % 2 == 0)							median = (ystats[l/2] + ystats[l/2-1])/2;						else							median = ystats[Math.floor(l/2)];						median = Math.round(100*median)/100;						return "median: " + median;					}); //median							lineplot1.render();			</script>			<script type="text/javascript+protovis"> 							data = plotdata['stats_per_day'];				xdata = data[0];				y2data = data[2];						// initialize some variables				var w = plotwidth,					h = plotheight/2,					xd = pv.Scale.linear(0, pv.max(xdata)).range(0,w),					yd = pv.Scale.linear(0, pv.max(y2data)).range(0,h),					title = "# of Ratings per Day",					ylabel = "# of Ratings",					xlabel = "Date";								var lineplot2 = new pv.Panel()				    .width(w)				    .height(h)					.margin(50);								// create x,y rules				lineplot2.add(pv.Rule)				    .data(function() yd.ticks(10))				    .bottom(yd)				    .strokeStyle("rgba(0, 47, 47, 0.2)")				  .anchor("left").add(pv.Label)				    .text(yd.tickFormat);				lineplot2.add(pv.Rule)				    .data(function() xd.ticks(8))				    .left(function(d) xd(d))				    .bottom(-5)				    .height(5)				  .anchor("bottom").add(pv.Label)				  	.text(function(d){						var sd = new Date(plotdata['start_date'].substring(0,10));						sd.setDate(sd.getDate()+d);						return sd.getUTCFullYear()+"-"+(sd.getUTCMonth()+1)+"-"+sd.getUTCDate()					})								lineplot2.add(pv.Rule)				    .bottom(0);				pointdata2 = []				for(var i=0; i<xdata.length; i++){					pointdata2.push([xdata[i], y2data[i]]);				}								pointdata2.sort(function(e1, e2) {return e1[0]-e2[0];});						lineplot2.add(pv.Line)					.data(function() {return pointdata2;})					.bottom(function(d) d[1]*yd(1))					.left(function(d) d[0]*xd(1));								// title				lineplot2.add(pv.Label)					.left(300)					.top(-10)				    .textAlign("center")					.font("bold 14px sans-serif")				    .text(function() title);				// y axis label				lineplot2.add(pv.Label)					.bottom(100)					.left(-35)					.textAngle(-Math.PI/2)				    .textAlign("center")					.font("12px sans-serif")				    .text(function() ylabel);				// x axis label				lineplot2.add(pv.Label)					.bottom(-30)					.left(300)					.textAlign("center")					.font("12px sans-serif")					.text(function() xlabel);								// labels for mean, std, mean				lineplot2.add(pv.Label)					.top(15)					.right(0)					.textAlign("center")					.font("12px sans-serif")					.text(function() "mean: " + Math.round(100*pv.mean(y2data))/100); // mean				lineplot2.add(pv.Label)					.top(30)					.right(0)					.font("12px sans-serif")					.textAlign("center")					.text(function() "std: " + Math.round(100*pv.deviation(y2data))/100); //std				lineplot2.add(pv.Label)					.top(45)					.right(0)					.textAlign("center")					.font("12px sans-serif")					.text(function() {						ystats = [];						for(var i=0; i < y2data.length; i++){							ystats.push(y2data[i]);						}						ystats.sort();						var l = ystats.length;						var median;						if(ystats.length == 1)							median = ystats[0];						else if (ystats.length % 2 == 0)							median = (ystats[l/2] + ystats[l/2-1])/2;						else							median = ystats[Math.floor(l/2)];						median = Math.round(100*median)/100;						return "median: " + median;					}); //median							lineplot2.render();			</script>			<script type="text/javascript+protovis"> 							data = plotdata['stats_per_day'];								xdata = data[0];				y3data = data[3];						// initialize some variables				var w = plotwidth,					h = plotheight/2,					xd = pv.Scale.linear(0, pv.max(xdata)).range(0,w),					yd = pv.Scale.linear(0, pv.max(y3data)).range(0,h),					title = "Unique Users per Day";					ylabel = "# of Unique Users";					xlabel = "Date";								var lineplot3 = new pv.Panel()				    .width(w)				    .height(h)					.margin(50);								// create x,y rules				lineplot3.add(pv.Rule)				    .data(function() yd.ticks(10))				    .bottom(yd)				    .strokeStyle("rgba(0, 47, 47, 0.2)")				  .anchor("left").add(pv.Label)				    .text(yd.tickFormat);				lineplot3.add(pv.Rule)				    .data(function() xd.ticks(8))				    .left(function(d) xd(d))				    .bottom(-5)				    .height(5)				  .anchor("bottom").add(pv.Label)				    .text(function(d){						var sd = new Date(plotdata['start_date'].substring(0,10));						sd.setDate(sd.getDate()+d);						return sd.getUTCFullYear()+"-"+(sd.getUTCMonth()+1)+"-"+sd.getUTCDate()					})								lineplot3.add(pv.Rule)				    .bottom(0);				pointdata3 = []				for(var i=0; i<xdata.length; i++){					pointdata3.push([xdata[i], y3data[i]]);				}								pointdata3.sort(function(e1,e2) {return e1[0]-e2[0];});						lineplot3.add(pv.Line)					.data(function() {return pointdata3;})					.bottom(function(d) d[1]*yd(1))					.left(function(d) d[0]*xd(1));								// title				lineplot3.add(pv.Label)					.left(300)					.top(-10)				    .textAlign("center")					.font("bold 14px sans-serif")				    .text(function() title);				// y axis label				lineplot3.add(pv.Label)					.bottom(100)					.left(-35)					.textAngle(-Math.PI/2)				    .textAlign("center")					.font("12px sans-serif")				    .text(function() ylabel);				// x axis label				lineplot3.add(pv.Label)					.bottom(-30)					.left(300)					.textAlign("center")					.font("12px sans-serif")					.text(function() xlabel);								// labels for mean, std, mean				lineplot3.add(pv.Label)					.top(15)					.right(0)					.textAlign("center")					.font("12px sans-serif")					.text(function() "mean: " + Math.round(100*pv.mean(y3data))/100); // mean				lineplot3.add(pv.Label)					.top(30)					.right(0)					.font("12px sans-serif")					.textAlign("center")					.text(function() "std: " + Math.round(100*pv.deviation(y3data))/100); //std				lineplot3.add(pv.Label)					.top(45)					.right(0)					.textAlign("center")					.font("12px sans-serif")					.text(function() {						ystats = [];						for(var i=0; i < y3data.length; i++){							ystats.push(y3data[i]);						}						var l = y3data.length;						var median;						if(ystats.length == 1)							median = ystats[0];						else if (ystats.length % 2 == 0)							median = (ystats[l/2] + ystats[l/2-1])/2;						else							median = ystats[Math.floor(l/2)];						median = Math.round(100*median)/100;						return "median: " + median;					}); //median							lineplot3.render();			</script>		</div>		<div id = "plot_points">			<script type="text/javascript+protovis"> // second half plot							data = plotdata['comments_returned'];								xdata = data[0];				ydata = data[1];						// initialize some variables				var w = plotwidth,					h = plotheight/2,					xd = pv.Scale.linear(0, pv.max(xdata)).range(0,w),					yd = pv.Scale.linear(0, pv.max(ydata)).range(0,h),					title = "Comment ID vs. # of Times Returned",					ylabel = "# of Times Returned",					xlabel = "Comment ID";								var pointplot = new pv.Panel()				    .width(w)				    .height(h)					.margin(50);								// create x,y rules				pointplot.add(pv.Rule)				    .data(function() yd.ticks(10))				    .bottom(yd)				    .strokeStyle("rgba(0, 47, 47, 0.2)")				  .anchor("left").add(pv.Label)				    .text(yd.tickFormat);				pointplot.add(pv.Rule)				    .data(function() xd.ticks())				    .left(xd)				    .bottom(-5)				    .height(5)				  .anchor("bottom").add(pv.Label)				    .text(xd.tickFormat);								pointplot.add(pv.Rule)				    .bottom(0);				pointdata = []				for(var i=0; i<xdata.length; i++){					pointdata.push([xdata[i], ydata[i]]);				}				pointplot.add(pv.Dot)					.data(function() {return pointdata;})					.bottom(function(d) d[1]*yd(1))					.left(function(d) d[0]*xd(1));								// title				pointplot.add(pv.Label)					.left(300)					.top(-10)				    .textAlign("center")					.font("bold 14px sans-serif")				    .text(function() title);				// y axis label				pointplot.add(pv.Label)					.bottom(100)					.left(-35)					.textAngle(-Math.PI/2)				    .textAlign("center")					.font("12px sans-serif")				    .text(function() ylabel);				// x axis label				pointplot.add(pv.Label)					.bottom(-35)					.left(300)					.textAlign("center")					.font("12px sans-serif")					.text(function() xlabel);								// labels for mean, std, mean				pointplot.add(pv.Label)					.top(15)					.right(0)					.textAlign("center")					.font("12px sans-serif")					.text(function() "mean: " + Math.round(100*pv.mean(ydata))/100); // mean				pointplot.add(pv.Label)					.top(30)					.right(0)					.font("12px sans-serif")					.textAlign("center")					.text(function() "std: " + Math.round(100*pv.deviation(ydata))/100); //std				ystats = []				for(var i=0; i< pointdata.length; i++)					ystats.push(pointdata[i][1]);								pointplot.add(pv.Label)					.top(45)					.right(0)					.textAlign("center")					.font("12px sans-serif")					.text(function() {						ystats.sort(function(a,b){return a - b;});						var l = ystats.length;						var median;						if(ystats.length == 1)							median = ystats[0];						else if (ystats.length % 2 == 0)							median = (ystats[l/2] + ystats[l/2-1])/2;						else							median = ystats[Math.floor(l/2)];						median = Math.round(100*median)/100;						return "median: " + median;					}); //median							pointplot.render();			</script>			<script type="text/javascript+protovis"> // second half plot							data = plotdata['comments_returned'];								xdata = data[0];				ydata = data[1];								pointdata = []				for(var i=0; i<xdata.length; i++){					pointdata.push([xdata[i], ydata[i]]);				}								pointdata = pointdata.filter(function(e) {return (e[1] < 1500);});						// initialize some variables				var w = plotwidth,					h = plotheight/2,					xd = pv.Scale.linear(0, pv.max(pointdata, function(e) e[0])).range(0,w),					yd = pv.Scale.linear(0, pv.max(pointdata, function(e) e[1])).range(0,h),					title = "Comment ID vs. # of Times Returned (Zoomed)",					ylabel = "# of Times Returned (0 < count < 1500)",					xlabel = "Comment ID";								var pointplot2 = new pv.Panel()				    .width(w)				    .height(h)					.margin(50);								// create x,y rules				pointplot2.add(pv.Rule)				    .data(function() yd.ticks(10))				    .bottom(yd)				    .strokeStyle("rgba(0, 47, 47, 0.2)")				  .anchor("left").add(pv.Label)				    .text(yd.tickFormat);				pointplot2.add(pv.Rule)				    .data(function() xd.ticks())				    .left(xd)				    .bottom(-5)				    .height(5)				  .anchor("bottom").add(pv.Label)				    .text(xd.tickFormat);								pointplot2.add(pv.Rule)				    .bottom(0);								pointplot2.add(pv.Dot)					.data(function() {return pointdata;})					.bottom(function(d) d[1]*yd(1))					.left(function(d) d[0]*xd(1));								// title				pointplot2.add(pv.Label)					.left(300)					.top(-10)				    .textAlign("center")					.font("bold 14px sans-serif")				    .text(function() title);				// y axis label				pointplot2.add(pv.Label)					.bottom(100)					.left(-35)					.textAngle(-Math.PI/2)				    .textAlign("center")					.font("12px sans-serif")				    .text(function() ylabel);				// x axis label				pointplot2.add(pv.Label)					.bottom(-35)					.left(300)					.textAlign("center")					.font("12px sans-serif")					.text(function() xlabel);								ystats = [];				for(var i=0; i < pointdata.length; i++){					ystats.push(parseInt(pointdata[i][1]));				}								// labels for mean, std, mean				pointplot2.add(pv.Label)					.top(15)					.right(0)					.textAlign("center")					.font("12px sans-serif")					.text(function() "mean: " + Math.round(100*pv.mean(ystats))/100); // mean				pointplot2.add(pv.Label)					.top(30)					.right(0)					.font("12px sans-serif")					.textAlign("center")					.text(function() "std: " + Math.round(100*pv.deviation(ystats))/100); //std												pointplot2.add(pv.Label)					.top(45)					.right(0)					.textAlign("center")					.font("12px sans-serif")					.text(function() {						ystats.sort(function(a,b){return a - b;});						console.log(ystats);						var l = ystats.length;						var median;						if(ystats.length == 1)							median = ystats[0];						else if (ystats.length % 2 == 0)							median = (ystats[l/2] + ystats[l/2-1])/2;						else							median = ystats[Math.floor(l/2)];						median = Math.round(100*median)/100;						return "median: " + median;					}); //median							pointplot2.render();			</script>		</div>			</div>	<!--	<div id="numberContainer" style="position:relative; top:150px; padding-right:15px" display="none">		<table style="align:right" id="numberTable">		</table>    </div>-->	</div>{% endblock %}